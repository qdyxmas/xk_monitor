pipeline {
agent any
stages {
	stage("update code") {
		steps {
			dir('k8s_test') {
					git branch: 'feature/qdy-k8s-test', credentialsId: 'd047f78f-33de-47b3-850e-217e41550946', url: 'https://git.xkool.org/qudeyong/k8s_test.git'
				}
			}
		}
	stage("docker build") {
		steps {
			dir('k8s_test') {
					sh 'docker build -t xkk8stest  -f Dockerfile .'
					sh 'docker tag image_id soloxmas/xkool-k8stest'
					sh 'docker tag image_id soloxmas/xkool-k8stest'
					sh 'docker push soloxmas/xkool-k8stest'
					sh 'kubectl apply -f k8stest-deploy-port.yml'
				}
			}
		}
	}
}